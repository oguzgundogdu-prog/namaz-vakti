(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(t){if(t.ep)return;t.ep=!0;const i=n(t);fetch(t.href,i)}})();const L=document.getElementById("location-name"),I=document.getElementById("date-display"),M=document.getElementById("next-prayer-name"),$=document.getElementById("countdown"),h=document.getElementById("prayer-times-list"),d=document.getElementById("notification-toggle"),b="https://api.aladhan.com/v1/timings",C=13,w={Tahajjud:"Teheccüd",Fajr:"İmsak",Sunrise:"Güneş",Dhuhr:"Öğle",Asr:"İkindi",Maghrib:"Akşam",Isha:"Yatsı"};window.PRAYER_NAMES_TR=w;const N=["Tahajjud","Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"];let s=null,p=null,a=null;"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(e=>{console.log("Service Worker registered:",e.scope)}).catch(e=>{console.error("Service Worker registration failed:",e)})});async function R(){H();try{const e=await x(),{latitude:o,longitude:n}=e.coords;await D(o,n),await B(o,n)}catch(e){console.error("Konum hatası:",e),L.textContent="İstanbul",await D(41.0082,28.9784)}}function x(){return new Promise((e,o)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e,o):o(new Error("Geolocation not supported"))})}async function B(e,o){try{const r=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${o}&accept-language=tr`)).json();if(r.address){const t=r.address.city||r.address.town||r.address.state||r.address.province;t&&(L.textContent=t)}}catch(n){console.error("Konum adı alınamadı:",n)}}function H(){const e={weekday:"long",year:"numeric",month:"long",day:"numeric"};I.textContent=new Date().toLocaleDateString("tr-TR",e)}async function D(e,o){try{const n=Math.floor(Date.now()/1e3),t=await(await fetch(`${b}/${n}?latitude=${e}&longitude=${o}&method=${C}`)).json();if(t.code===200)s=t.data,O(),_(),P();else throw new Error("API Error")}catch(n){console.error("Veri çekme hatası:",n),h.innerHTML='<div class="loading-spinner">Veri çekilemedi. Lütfen sayfayı yenileyin.</div>'}}function O(){if(!s||!s.timings)return;const e=s.timings.Fajr,[o,n]=e.split(":").map(Number),r=new Date;r.setHours(o,n,0,0);const t=new Date(r.getTime()-3600*1e3),i=t.getHours().toString().padStart(2,"0"),c=t.getMinutes().toString().padStart(2,"0");s.timings.Tahajjud=`${i}:${c}`}function _(){h.innerHTML="";const e=s.timings;N.forEach(o=>{const n=e[o],r=w[o],t=document.createElement("div");t.className="prayer-item",t.dataset.key=o,t.innerHTML=`
      <span class="prayer-name">${r}</span>
      <span class="prayer-time">${n}</span>
    `,h.appendChild(t)})}function P(){j(),p&&clearInterval(p),p=setInterval(j,1e3)}function j(){if(!s)return;const e=new Date,o=s.timings;let n=null,r=1/0,t="";for(const l of N){const m=o[l],[f,A]=m.split(":").map(Number),u=new Date;if(u.setHours(f,A,0,0),u>e){const E=u-e;E<r&&(r=E,n=u,t=l)}}let i=!1;if(!n){const l=o.Fajr,[m,f]=l.split(":").map(Number);n=new Date,n.setDate(n.getDate()+1),n.setHours(m,f,0,0),t="Fajr",i=!0}const c=n-new Date;if(c<0){P();return}const T=Math.floor(c/(1e3*60*60)),S=Math.floor(c%(1e3*60*60)/(1e3*60)),k=Math.floor(c%(1e3*60)/1e3);$.textContent=`${g(T)}:${g(S)}:${g(k)}`;const v=w[t];M.textContent=i?`${v} (Yarın)`:v,document.querySelectorAll(".prayer-item").forEach(l=>{l.classList.remove("active"),l.dataset.key===t&&l.classList.add("active")})}function g(e){return e.toString().padStart(2,"0")}function F(){if(typeof window.PrayerNotifications>"u"){console.warn("PrayerNotifications not loaded yet");return}a=new window.PrayerNotifications,y(),d.addEventListener("click",async()=>{a.permission==="granted"&&a.settings.enabled?(a.settings.enabled=!1,a.saveSettings(),a.stopChecking(),y()):(await a.requestPermission()&&s&&a.startChecking(s),y())}),a.settings.enabled&&s&&a.startChecking(s)}function y(){a&&(a.permission==="granted"&&a.settings.enabled?(d.classList.add("active"),d.title="Bildirimler Açık (Kapatmak için tıklayın)"):(d.classList.remove("active"),d.title="Bildirimler Kapalı (Açmak için tıklayın)"))}window.addEventListener("load",()=>{setTimeout(F,100)});R();
