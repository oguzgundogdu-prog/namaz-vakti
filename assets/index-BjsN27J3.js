(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=e(a);fetch(a.href,s)}})();const b=document.getElementById("location-name"),$=document.getElementById("date-display"),E=document.getElementById("next-prayer-name"),x=document.getElementById("countdown"),w=document.getElementById("prayer-times-list"),j=document.getElementById("nafile-list"),L="https://api.aladhan.com/v1/timings",N=13,k={Tahajjud:"Teheccüd",Fajr:"İmsak",Sunrise:"Güneş",Dhuhr:"Öğle",Asr:"İkindi",Maghrib:"Akşam",Isha:"Yatsı"},h=["Tahajjud","Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"];let i=null,v=null,d=null,u={};async function C(){H();try{const t=await I(),{latitude:o,longitude:e}=t.coords;await p(o,e),await P(o,e)}catch(t){console.error("Konum hatası:",t),b.textContent="İstanbul",await p(41.0082,28.9784)}}function I(){return new Promise((t,o)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t,o):o(new Error("Geolocation not supported"))})}async function P(t,o){try{const n=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t}&lon=${o}&accept-language=tr`)).json();if(n&&n.address){const a=n.address.city||n.address.town||n.address.village||n.address.state||"İstanbul";b.textContent=a}}catch(e){console.error("Konum ismi alınamadı:",e)}}async function p(t,o){try{const e=Math.floor(Date.now()/1e3),n=`${L}/${e}?latitude=${t}&longitude=${o}&method=${N}`,s=await(await fetch(n)).json();if(s.code===200)i=s.data,A(),R(),M(),B(),S();else throw new Error("API error")}catch(e){console.error("Namaz vakitleri alınamadı:",e),w.innerHTML='<p style="text-align:center;">Veriler yüklenemedi. Lütfen tekrar deneyin.</p>'}}function A(){if(!i||!i.timings)return;const t=i.timings.Fajr,[o,e]=t.split(":").map(Number),n=new Date;n.setHours(o,e,0,0);const a=new Date(n.getTime()-3600*1e3),s=a.getHours().toString().padStart(2,"0"),r=a.getMinutes().toString().padStart(2,"0");i.timings.Tahajjud=`${s}:${r}`}function M(){if(!i)return;const t=i.timings,o=new Date;w.innerHTML=h.map(e=>{const n=t[e],[a,s]=n.split(":").map(Number),r=new Date;return r.setHours(a,s,0,0),`
      <div class="prayer-item ${r<o?"past":""}" data-prayer="${e}">
        <span class="prayer-name">${k[e]}</span>
        <span class="prayer-time">${n}</span>
      </div>
    `}).join("")}function S(){if(!i)return;const t=i.timings,o=new Date;let e=null,n=!1;for(const a of h){const s=t[a],[r,l]=s.split(":").map(Number),c=new Date;if(c.setHours(r,l,0,0),c>o){e={key:a,time:c};break}}if(!e){const a=h[0],s=t[a],[r,l]=s.split(":").map(Number),c=new Date;c.setDate(c.getDate()+1),c.setHours(r,l,0,0),e={key:a,time:c},n=!0}v=e.time,document.querySelectorAll(".prayer-item").forEach(a=>{a.dataset.prayer===e.key&&!n&&a.classList.add("active")}),d&&clearInterval(d),g(e.key,n),d=setInterval(()=>g(e.key,n),1e3)}function g(t,o){const n=v-new Date;if(n<0){S();return}const a=Math.floor(n/(1e3*60*60)),s=Math.floor(n%(1e3*60*60)/(1e3*60)),r=Math.floor(n%(1e3*60)/1e3);x.textContent=`${m(a)}:${m(s)}:${m(r)}`;const l=k[t];E.textContent=o?`${l} (Yarın)`:l}function H(){const t=new Date,o={day:"2-digit",month:"long",year:"numeric"},e=t.toLocaleDateString("tr-TR",o);$.textContent=e}function m(t){return t.toString().padStart(2,"0")}function O(){const t=document.querySelectorAll(".tab-btn"),o=document.querySelectorAll(".tab-content");if(!t||t.length===0){console.warn("Tab buttons not found");return}t.forEach(e=>{e.addEventListener("click",function(){const n=this.getAttribute("data-tab");t.forEach(s=>s.classList.remove("active")),o.forEach(s=>s.classList.remove("active")),this.classList.add("active");const a=document.getElementById(n+"-content");a&&a.classList.add("active")})})}function R(){if(!i||!i.timings)return;const t=i.timings,o=y(t.Sunrise),e=new Date(o.getTime()+1200*1e3),n=new Date;n.setHours(10,30,0,0);const a=y(t.Maghrib),s=new Date(a.getTime()+900*1e3);u={israk:f(e),kusluk:f(n),evvabin:f(s)}}function y(t){const[o,e]=t.split(":").map(Number),n=new Date;return n.setHours(o,e,0,0),n}function f(t){const o=t.getHours().toString().padStart(2,"0"),e=t.getMinutes().toString().padStart(2,"0");return`${o}:${e}`}function B(){var e;const t=[{id:"teheccud",name:"Teheccüd",time:((e=i==null?void 0:i.timings)==null?void 0:e.Tahajjud)||"--:--",description:"İmsak'tan 1 saat önce"},{id:"israk",name:"İşrak",time:u.israk,description:"Güneş doğduktan 20 dk sonra"},{id:"kusluk",name:"Kuşluk",time:u.kusluk,description:"Sabah ortası"},{id:"evvabin",name:"Evvabin",time:u.evvabin,description:"Akşam-Yatsı arası"}],o=D();j.innerHTML=t.map(n=>{const a=o[n.id]||!1;return`
      <div class="nafile-item ${a?"completed":""}" data-prayer-id="${n.id}">
        <div class="nafile-item-info">
          <div class="nafile-name">${n.name}</div>
          <div class="nafile-time">${n.time} - ${n.description}</div>
        </div>
        <label class="nafile-checkbox">
          <input type="checkbox" id="nafile-${n.id}" name="nafile-${n.id}" ${a?"checked":""} onchange="handleNafileCheckbox('${n.id}', this.checked)">
          <span class="checkbox-custom"></span>
        </label>
      </div>
    `}).join("")}function T(t,o){q(t,o);const e=document.querySelector(`[data-prayer-id="${t}"]`);o?e.classList.add("completed"):e.classList.remove("completed")}function q(t,o){const e=D();e[t]=o,localStorage.setItem("nafileCheckboxes",JSON.stringify(e))}function D(){const t=new Date().toDateString(),o=localStorage.getItem("nafileCheckboxes");return localStorage.getItem("nafileCheckboxesDate")!==t?(localStorage.setItem("nafileCheckboxesDate",t),localStorage.removeItem("nafileCheckboxes"),{}):o?JSON.parse(o):{}}window.handleNafileCheckbox=T;window.handleNafileCheckbox=T;O();C();
