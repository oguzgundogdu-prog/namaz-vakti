(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();const b=document.getElementById("location-name"),E=document.getElementById("date-display"),$=document.getElementById("next-prayer-name"),x=document.getElementById("countdown"),k=document.getElementById("prayer-times-list"),L=document.getElementById("nafile-list"),C="https://api.aladhan.com/v1/timings",N=13,w={Tahajjud:"Teheccüd",Fajr:"İmsak",Sunrise:"Güneş",Dhuhr:"Öğle",Asr:"İkindi",Maghrib:"Akşam",Isha:"Yatsı"},h=["Tahajjud","Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"];let r=null,v=null,u=null,d={};async function I(){j();try{const e=await P(),{latitude:o,longitude:t}=e.coords;await p(o,t),await A(o,t)}catch(e){console.error("Konum hatası:",e),b.textContent="İstanbul",await p(41.0082,28.9784)}}function P(){return new Promise((e,o)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e,o):o(new Error("Geolocation not supported"))})}async function A(e,o){try{const n=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${o}&accept-language=tr`)).json();if(n&&n.address){const a=n.address.city||n.address.town||n.address.village||n.address.state||"İstanbul";b.textContent=a}}catch(t){console.error("Konum ismi alınamadı:",t)}}async function p(e,o){try{const t=Math.floor(Date.now()/1e3),n=`${C}/${t}?latitude=${e}&longitude=${o}&method=${N}`,s=await(await fetch(n)).json();if(s.code===200)r=s.data,H(),M(),R(),S();else throw new Error("API error")}catch(t){console.error("Namaz vakitleri alınamadı:",t),k.innerHTML='<p style="text-align:center;">Veriler yüklenemedi. Lütfen tekrar deneyin.</p>'}}function M(){if(!r)return;const e=r.timings,o=new Date;k.innerHTML=h.map(t=>{const n=e[t],[a,s]=n.split(":").map(Number),i=new Date;return i.setHours(a,s,0,0),`
      <div class="prayer-item ${i<o?"past":""}" data-prayer="${t}">
        <span class="prayer-name">${w[t]}</span>
        <span class="prayer-time">${n}</span>
      </div>
    `}).join("")}function S(){if(!r)return;const e=r.timings,o=new Date;let t=null,n=!1;for(const a of h){const s=e[a],[i,l]=s.split(":").map(Number),c=new Date;if(c.setHours(i,l,0,0),c>o){t={key:a,time:c};break}}if(!t){const a=h[0],s=e[a],[i,l]=s.split(":").map(Number),c=new Date;c.setDate(c.getDate()+1),c.setHours(i,l,0,0),t={key:a,time:c},n=!0}v=t.time,document.querySelectorAll(".prayer-item").forEach(a=>{a.dataset.prayer===t.key&&!n&&a.classList.add("active")}),u&&clearInterval(u),g(t.key,n),u=setInterval(()=>g(t.key,n),1e3)}function g(e,o){const n=v-new Date;if(n<0){S();return}const a=Math.floor(n/(1e3*60*60)),s=Math.floor(n%(1e3*60*60)/(1e3*60)),i=Math.floor(n%(1e3*60)/1e3);x.textContent=`${m(a)}:${m(s)}:${m(i)}`;const l=w[e];$.textContent=o?`${l} (Yarın)`:l}function j(){const e=new Date,o={day:"2-digit",month:"long",year:"numeric"},t=e.toLocaleDateString("tr-TR",o);E.textContent=t}function m(e){return e.toString().padStart(2,"0")}function O(){const e=document.querySelectorAll(".tab-btn"),o=document.querySelectorAll(".tab-content");if(!e||e.length===0){console.warn("Tab buttons not found");return}e.forEach(t=>{t.addEventListener("click",function(){const n=this.getAttribute("data-tab");e.forEach(s=>s.classList.remove("active")),o.forEach(s=>s.classList.remove("active")),this.classList.add("active");const a=document.getElementById(n+"-content");a&&a.classList.add("active")})})}function H(){if(!r||!r.timings)return;const e=r.timings,o=y(e.Sunrise),t=new Date(o.getTime()+1200*1e3),n=new Date;n.setHours(10,30,0,0);const a=y(e.Maghrib),s=new Date(a.getTime()+900*1e3);d={israk:f(t),kusluk:f(n),evvabin:f(s)}}function y(e){const[o,t]=e.split(":").map(Number),n=new Date;return n.setHours(o,t,0,0),n}function f(e){const o=e.getHours().toString().padStart(2,"0"),t=e.getMinutes().toString().padStart(2,"0");return`${o}:${t}`}function R(){var t;const e=[{id:"teheccud",name:"Teheccüd",time:((t=r==null?void 0:r.timings)==null?void 0:t.Tahajjud)||"--:--",description:"İmsak'tan 1 saat önce"},{id:"israk",name:"İşrak",time:d.israk,description:"Güneş doğduktan 20 dk sonra"},{id:"kusluk",name:"Kuşluk",time:d.kusluk,description:"Sabah ortası"},{id:"evvabin",name:"Evvabin",time:d.evvabin,description:"Akşam-Yatsı arası"}],o=D();L.innerHTML=e.map(n=>{const a=o[n.id]||!1;return`
      <div class="nafile-item ${a?"completed":""}" data-prayer-id="${n.id}">
        <div class="nafile-item-info">
          <div class="nafile-name">${n.name}</div>
          <div class="nafile-time">${n.time} - ${n.description}</div>
        </div>
        <label class="nafile-checkbox">
          <input type="checkbox" id="nafile-${n.id}" name="nafile-${n.id}" ${a?"checked":""} onchange="handleNafileCheckbox('${n.id}', this.checked)">
          <span class="checkbox-custom"></span>
        </label>
      </div>
    `}).join("")}function T(e,o){B(e,o);const t=document.querySelector(`[data-prayer-id="${e}"]`);o?t.classList.add("completed"):t.classList.remove("completed")}function B(e,o){const t=D();t[e]=o,localStorage.setItem("nafileCheckboxes",JSON.stringify(t))}function D(){const e=new Date().toDateString(),o=localStorage.getItem("nafileCheckboxes");return localStorage.getItem("nafileCheckboxesDate")!==e?(localStorage.setItem("nafileCheckboxesDate",e),localStorage.removeItem("nafileCheckboxes"),{}):o?JSON.parse(o):{}}window.handleNafileCheckbox=T;window.handleNafileCheckbox=T;O();I();
