(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();const w=document.getElementById("location-name"),D=document.getElementById("date-display"),$=document.getElementById("next-prayer-name"),j=document.getElementById("countdown"),k=document.getElementById("prayer-times-list"),x=document.getElementById("nafile-list"),E="https://api.aladhan.com/v1/timings",C=13,b={Tahajjud:"Teheccüd",Fajr:"İmsak",Sunrise:"Güneş",Dhuhr:"Öğle",Asr:"İkindi",Maghrib:"Akşam",Isha:"Yatsı"},p=["Tahajjud","Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"];let i=null,v=null,d=null,u={};async function N(){A();try{const n=await P(),{latitude:a,longitude:e}=n.coords;await h(a,e),await I(a,e)}catch(n){console.error("Konum hatası:",n),w.textContent="İstanbul",await h(41.0082,28.9784)}}function P(){return new Promise((n,a)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(n,a):a(new Error("Geolocation not supported"))})}async function I(n,a){try{const t=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${n}&lon=${a}&accept-language=tr`)).json();if(t&&t.address){const o=t.address.city||t.address.town||t.address.village||t.address.state||"İstanbul";w.textContent=o}}catch(e){console.error("Konum ismi alınamadı:",e)}}async function h(n,a){try{const e=Math.floor(Date.now()/1e3),t=`${E}/${e}?latitude=${n}&longitude=${a}&method=${C}`,s=await(await fetch(t)).json();if(s.code===200)i=s.data,L(),H(),M(),O(),S();else throw new Error("API error")}catch(e){console.error("Namaz vakitleri alınamadı:",e),k.innerHTML='<p style="text-align:center;">Veriler yüklenemedi. Lütfen tekrar deneyin.</p>'}}function L(){if(!i||!i.timings)return;const n=i.timings.Fajr,[a,e]=n.split(":").map(Number),t=new Date;t.setHours(a,e,0,0);const o=new Date(t.getTime()-3600*1e3),s=o.getHours().toString().padStart(2,"0"),r=o.getMinutes().toString().padStart(2,"0");i.timings.Tahajjud=`${s}:${r}`}function M(){if(!i)return;const n=i.timings,a=new Date;k.innerHTML=p.map(e=>{const t=n[e],[o,s]=t.split(":").map(Number),r=new Date;return r.setHours(o,s,0,0),`
      <div class="prayer-item ${r<a?"past":""}" data-prayer="${e}">
        <span class="prayer-name">${b[e]}</span>
        <span class="prayer-time">${t}</span>
      </div>
    `}).join("")}function S(){if(!i)return;const n=i.timings,a=new Date;let e=null,t=!1;for(const o of p){const s=n[o],[r,l]=s.split(":").map(Number),c=new Date;if(c.setHours(r,l,0,0),c>a){e={key:o,time:c};break}}if(!e){const o=p[0],s=n[o],[r,l]=s.split(":").map(Number),c=new Date;c.setDate(c.getDate()+1),c.setHours(r,l,0,0),e={key:o,time:c},t=!0}v=e.time,document.querySelectorAll(".prayer-item").forEach(o=>{o.dataset.prayer===e.key&&!t&&o.classList.add("active")}),d&&clearInterval(d),g(e.key,t),d=setInterval(()=>g(e.key,t),1e3)}function g(n,a){const t=v-new Date;if(t<0){S();return}const o=Math.floor(t/(1e3*60*60)),s=Math.floor(t%(1e3*60*60)/(1e3*60)),r=Math.floor(t%(1e3*60)/1e3);j.textContent=`${m(o)}:${m(s)}:${m(r)}`;const l=b[n];$.textContent=a?`${l} (Yarın)`:l}function A(){const n=new Date,a={day:"2-digit",month:"long",year:"numeric"},e=n.toLocaleDateString("tr-TR",a);D.textContent=e}function m(n){return n.toString().padStart(2,"0")}N();function H(){if(!i||!i.timings)return;const n=i.timings,a=y(n.Sunrise),e=new Date(a.getTime()+1200*1e3),t=new Date;t.setHours(10,30,0,0);const o=y(n.Maghrib),s=new Date(o.getTime()+900*1e3);u={israk:f(e),kusluk:f(t),evvabin:f(s)}}function y(n){const[a,e]=n.split(":").map(Number),t=new Date;return t.setHours(a,e,0,0),t}function f(n){const a=n.getHours().toString().padStart(2,"0"),e=n.getMinutes().toString().padStart(2,"0");return`${a}:${e}`}function O(){var e;const n=[{id:"teheccud",name:"Teheccüd",time:((e=i==null?void 0:i.timings)==null?void 0:e.Tahajjud)||"--:--",description:"İmsak'tan 1 saat önce"},{id:"israk",name:"İşrak",time:u.israk,description:"Güneş doğduktan 20 dk sonra"},{id:"kusluk",name:"Kuşluk",time:u.kusluk,description:"Sabah ortası"},{id:"evvabin",name:"Evvabin",time:u.evvabin,description:"Akşam-Yatsı arası"}],a=T();x.innerHTML=n.map(t=>{const o=a[t.id]||!1;return`
      <div class="nafile-item ${o?"completed":""}" data-prayer-id="${t.id}">
        <div class="nafile-item-info">
          <div class="nafile-name">${t.name}</div>
          <div class="nafile-time">${t.time} - ${t.description}</div>
        </div>
        <label class="nafile-checkbox">
          <input type="checkbox" id="nafile-${t.id}" name="nafile-${t.id}" ${o?"checked":""} onchange="handleNafileCheckbox('${t.id}', this.checked)">
          <span class="checkbox-custom"></span>
        </label>
      </div>
    `}).join("")}function R(n,a){B(n,a);const e=document.querySelector(`[data-prayer-id="${n}"]`);a?e.classList.add("completed"):e.classList.remove("completed")}function B(n,a){const e=T();e[n]=a,localStorage.setItem("nafileCheckboxes",JSON.stringify(e))}function T(){const n=new Date().toDateString(),a=localStorage.getItem("nafileCheckboxes");return localStorage.getItem("nafileCheckboxesDate")!==n?(localStorage.setItem("nafileCheckboxesDate",n),localStorage.removeItem("nafileCheckboxes"),{}):a?JSON.parse(a):{}}window.handleNafileCheckbox=R;
