(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();const j=document.getElementById("location-name"),Y=document.getElementById("date-display"),z=document.getElementById("next-prayer-name"),F=document.getElementById("countdown"),N=document.getElementById("prayer-times-list"),K=document.getElementById("nafile-list"),_="https://api.aladhan.com/v1/timings",A=13,B={Tahajjud:"Teheccüd",Fajr:"İmsak",Sunrise:"Güneş",Dhuhr:"Öğle",Asr:"İkindi",Maghrib:"Akşam",Isha:"Yatsı"},w=["Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"];let r=null,P=null,b=null,m={};async function G(){W();try{const t=await J(),{latitude:n,longitude:e}=t.coords;h={latitude:n,longitude:e},await $(n,e),await Q(n,e)}catch(t){console.error("Konum hatası:",t),j.textContent="İstanbul",h={latitude:41.0082,longitude:28.9784},await $(41.0082,28.9784)}}function J(){return new Promise((t,n)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t,n):n(new Error("Geolocation not supported"))})}async function Q(t,n){try{const a=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t}&lon=${n}&accept-language=tr`)).json();if(a&&a.address){const o=a.address.city||a.address.town||a.address.village||a.address.state||"İstanbul";j.textContent=o}}catch(e){console.error("Konum ismi alınamadı:",e)}}async function $(t,n){try{const e=Math.floor(Date.now()/1e3),a=`${_}/${e}?latitude=${t}&longitude=${n}&method=${A}`,s=await(await fetch(a)).json();if(s.code===200)r=s.data,U(),Z(),V(),tt(),H();else throw new Error("API error")}catch(e){console.error("Namaz vakitleri alınamadı:",e),N.innerHTML='<p style="text-align:center;">Veriler yüklenemedi. Lütfen tekrar deneyin.</p>'}}function U(){if(!r||!r.timings)return;const t=r.timings.Fajr,[n,e]=t.split(":").map(Number),a=new Date;a.setHours(n,e,0,0);const o=new Date(a.getTime()-3600*1e3),s=o.getHours().toString().padStart(2,"0"),i=o.getMinutes().toString().padStart(2,"0");r.timings.Tahajjud=`${s}:${i}`}function V(){if(!r)return;const t=r.timings,n=new Date;N.innerHTML=w.map(e=>{const a=t[e],[o,s]=a.split(":").map(Number),i=new Date;return i.setHours(o,s,0,0),`
      <div class="prayer-item ${i<n?"past":""}" data-prayer="${e}">
        <span class="prayer-name">${B[e]}</span>
        <span class="prayer-time">${a}</span>
      </div>
    `}).join("")}function H(){if(!r)return;const t=r.timings,n=new Date;let e=null,a=!1;for(const o of w){const s=t[o],[i,c]=s.split(":").map(Number),d=new Date;if(d.setHours(i,c,0,0),d>n){e={key:o,time:d};break}}if(!e){const o=w[0],s=t[o],[i,c]=s.split(":").map(Number),d=new Date;d.setDate(d.getDate()+1),d.setHours(i,c,0,0),e={key:o,time:d},a=!0}P=e.time,document.querySelectorAll(".prayer-item").forEach(o=>{o.dataset.prayer===e.key&&!a&&o.classList.add("active")}),b&&clearInterval(b),T(e.key,a),b=setInterval(()=>T(e.key,a),1e3)}function T(t,n){const a=P-new Date;if(a<0){H();return}const o=Math.floor(a/(1e3*60*60)),s=Math.floor(a%(1e3*60*60)/(1e3*60)),i=Math.floor(a%(1e3*60)/1e3);F.textContent=`${v(o)}:${v(s)}:${v(i)}`;const c=B[t];z.textContent=n?`${c} (Yarın)`:c}function W(){const t=new Date,n={day:"2-digit",month:"long",year:"numeric"},e=t.toLocaleDateString("tr-TR",n);Y.textContent=e}function v(t){return t.toString().padStart(2,"0")}function X(){const t=document.querySelectorAll(".tab-btn"),n=document.querySelectorAll(".tab-content");if(!t||t.length===0){console.warn("Tab buttons not found");return}t.forEach(e=>{e.addEventListener("click",function(){const a=this.getAttribute("data-tab");t.forEach(s=>s.classList.remove("active")),n.forEach(s=>s.classList.remove("active")),this.classList.add("active");const o=document.getElementById(a+"-content");o&&o.classList.add("active")})})}function Z(){if(!r||!r.timings)return;const t=r.timings,n=D(t.Sunrise),e=new Date(n.getTime()+1200*1e3),a=new Date;a.setHours(10,30,0,0);const o=D(t.Maghrib),s=new Date(o.getTime()+900*1e3);m={israk:k(e),kusluk:k(a),evvabin:k(s)}}function D(t){const[n,e]=t.split(":").map(Number),a=new Date;return a.setHours(n,e,0,0),a}function k(t){const n=t.getHours().toString().padStart(2,"0"),e=t.getMinutes().toString().padStart(2,"0");return`${n}:${e}`}function tt(){var e;const t=[{id:"teheccud",name:"Teheccüd",time:((e=r==null?void 0:r.timings)==null?void 0:e.Tahajjud)||"--:--",description:"İmsak'tan 1 saat önce"},{id:"israk",name:"İşrak",time:m.israk,description:"Güneş doğduktan 20 dk sonra"},{id:"kusluk",name:"Kuşluk",time:m.kusluk,description:"Sabah ortası"},{id:"evvabin",name:"Evvabin",time:m.evvabin,description:"Akşam-Yatsı arası"}],n=O();K.innerHTML=t.map(a=>{const o=n[a.id]||!1;return`
      <div class="nafile-item ${o?"completed":""}" data-prayer-id="${a.id}">
        <div class="nafile-item-info">
          <div class="nafile-name">${a.name}</div>
          <div class="nafile-time">${a.time} - ${a.description}</div>
        </div>
        <label class="nafile-checkbox">
          <input type="checkbox" id="nafile-${a.id}" name="nafile-${a.id}" ${o?"checked":""} onchange="handleNafileCheckbox('${a.id}', this.checked)">
          <span class="checkbox-custom"></span>
        </label>
      </div>
    `}).join("")}function et(t,n){nt(t,n);const e=document.querySelector(`[data-prayer-id="${t}"]`);n?e.classList.add("completed"):e.classList.remove("completed")}function nt(t,n){const e=O();e[t]=n,localStorage.setItem("nafileCheckboxes",JSON.stringify(e))}function O(){const t=new Date().toDateString(),n=localStorage.getItem("nafileCheckboxes");return localStorage.getItem("nafileCheckboxesDate")!==t?(localStorage.setItem("nafileCheckboxesDate",t),localStorage.removeItem("nafileCheckboxes"),{}):n?JSON.parse(n):{}}window.handleNafileCheckbox=et;let l=new Date().getMonth(),u=new Date().getFullYear(),f=null,h={latitude:41.0082,longitude:28.9784};const S=document.getElementById("settings-btn"),q=document.getElementById("settings-sidebar"),g=document.getElementById("sidebar-overlay"),L=document.getElementById("sidebar-close-btn"),x=document.querySelectorAll(".sidebar-tab-btn"),M=document.getElementById("prev-month-btn"),C=document.getElementById("next-month-btn"),I=document.getElementById("current-month-display"),p=document.getElementById("calendar-tbody"),y=document.getElementById("quotes-list");function at(){q.classList.add("active"),g.classList.add("active"),document.body.style.overflow="hidden"}function R(){q.classList.remove("active"),g.classList.remove("active"),document.body.style.overflow=""}S&&S.addEventListener("click",()=>{at(),f||E(u,l+1),y&&y.children.length===0&&it()});L&&L.addEventListener("click",R);g&&g.addEventListener("click",R);x.forEach(t=>{t.addEventListener("click",function(){const n=this.getAttribute("data-sidebar-tab");x.forEach(a=>a.classList.remove("active")),document.querySelectorAll(".sidebar-tab-content").forEach(a=>{a.classList.remove("active")}),this.classList.add("active");const e=document.getElementById(n+"-content");e&&e.classList.add("active")})});M&&M.addEventListener("click",()=>{l--,l<0&&(l=11,u--),E(u,l+1)});C&&C.addEventListener("click",()=>{l++,l>11&&(l=0,u++),E(u,l+1)});async function E(t,n){try{const e=`https://api.aladhan.com/v1/calendar/${t}/${n}?latitude=${h.latitude}&longitude=${h.longitude}&method=${A}`,o=await(await fetch(e)).json();if(o.code===200&&o.data)f=o.data,ot(),st();else throw new Error("Calendar API error")}catch(e){console.error("Aylık takvim yüklenemedi:",e),p&&(p.innerHTML='<tr><td colspan="7" style="text-align:center; padding:20px;">Takvim yüklenemedi</td></tr>')}}function ot(){if(!f||!p)return;const t=new Date,n=t.getDate(),e=t.getMonth(),a=t.getFullYear(),o=l===e&&u===a;p.innerHTML=f.map((s,i)=>{const c=s.timings,d=i+1;return`
      <tr class="${o&&d===n?"today":""}">
        <td>${d}</td>
        <td>${c.Fajr}</td>
        <td>${c.Sunrise}</td>
        <td>${c.Dhuhr}</td>
        <td>${c.Asr}</td>
        <td>${c.Maghrib}</td>
        <td>${c.Isha}</td>
      </tr>
    `}).join("")}function st(){if(!I)return;const t=["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"];I.textContent=`${t[l]} ${u}`}function it(){if(!y)return;const t=[{text:"Namaz, müminin miracıdır.",author:"Hz. Muhammed (s.a.v)"},{text:"Sabır, imanın yarısıdır.",author:"Hz. Muhammed (s.a.v)"},{text:"İlim Çin'de de olsa gidiniz.",author:"Hz. Muhammed (s.a.v)"}];y.innerHTML=t.map(n=>`
    <div class="quote-card">
      <p class="quote-text">${n.text}</p>
      <p class="quote-author">— ${n.author}</p>
    </div>
  `).join("")}X();G();
